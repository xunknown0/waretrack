<% 
// Menu definition
const menu = [
  { title: 'Dashboard', icon: 'fa fa-dashboard', link: '/dashboard' },
  { 
    title: 'Inventory', icon: 'fa-solid fa-box', children: [
      { title: 'Products', icon: 'fa-solid fa-bag-shopping', link: '/products' },
      { title: 'Categories', icon: 'fa-solid fa-tags', link: '/categories' }
    ]
  },
  { 
    title: 'Users', icon: 'fa-solid fa-user-gear', children: [
      { title: 'Create User', icon: 'fa-solid fa-user-plus', link: '/user/users/create', roles: ['superadmin', 'admin'] },
      { title: 'List Users', icon: 'fa-solid fa-users', link: '/user/users', roles: ['superadmin', 'admin'] }
    ]
  },
  { 
    title: 'Orders', icon: 'fas fa-shopping-cart', children: [
      { title: 'Pending', icon: 'fa-solid fa-hourglass-half', link: '#' },
      { title: 'Completed', icon: 'fa-solid fa-circle-check', link: '#' }
    ]
  }
];
%>

<nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
  <div class="sb-sidenav-menu">
    <div class="nav">

      <% menu.forEach((item, index) => { 
           let visibleChildren = [];
           if (item.children) {
             visibleChildren = item.children.filter(child => {
               const hasRoleAccess = !child.roles || child.roles.includes(currentUserRole);
               const isCategoriesRestricted = child.title === 'Categories' && currentUserRole === 'staff';
               return hasRoleAccess && !isCategoriesRestricted;
             });
           }
      %>

        <% if(item.children && visibleChildren.length > 0) { %>
          <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapse<%= index %>" aria-expanded="<%= visibleChildren.some(c => c.link === currentPath) ? 'true' : 'false' %>">
            <div class="sb-nav-link-icon"><i class="<%= item.icon %>"></i></div>
            <%= item.title %>
            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-caret-down"></i></div>
          </a>
          <div class="collapse <%= visibleChildren.some(c => c.link === currentPath) ? 'show' : '' %>" id="collapse<%= index %>" data-bs-parent="#sidenavAccordion">
            <nav class="sb-sidenav-menu-nested nav">
              <% visibleChildren.forEach(child => { %>
                <a class="nav-link <%= child.link === currentPath ? 'active' : '' %>" href="<%= child.link %>">
                  <i class="<%= child.icon %> me-2"></i><%= child.title %>
                </a>
              <% }) %>
            </nav>
          </div>
        <% } else if (!item.children) { %>
          <a class="nav-link <%= item.link === currentPath ? 'active' : '' %>" href="<%= item.link %>">
            <div class="sb-nav-link-icon"><i class="<%= item.icon %>"></i></div>
            <%= item.title %>
          </a>
        <% } %>

      <% }) %>

<ul class="sidebar-menu">
  <% menu.forEach((item, idx) => { %>
    <!-- your menu items here -->
  <% }) %>
<li class="nav-item mt-3">
  <form action="/user/logout" method="POST" class="d-inline w-100">
    <button type="submit" class="btn btn-danger w-100 d-flex align-items-center justify-content-center"
            onclick="return confirm('Are you sure you want to logout?');">
      <i class="fa fa-sign-out-alt me-2"></i> Logout
    </button>
  </form>
</li>


    </div>
  </div>
</nav>

<script>
  document.getElementById('logoutForm').addEventListener('submit', function(e) {
    const confirmed = confirm('Are you sure you want to logout?');
    if (!confirmed) {
      e.preventDefault(); // Prevent form submission if canceled
    }
  });
</script>